
define(['jquery','core/str','core/ajax','core/templates','core/notification',],function($,Str,Ajax,templates,notification){return{TEMPLATE:{reminders:{src:'theme_stardust/reminders',id:'reminders'},reminder:{src:'theme_stardust/reminder',id:'reminder'},},init:function(){var context=this;context.getReminders();$(document).on('click','#opennewreminder',function(){context.openReminderForm();});$(document).on('click','#closereminder',function(){context.closeReminderForm();});$(document).on('click','#addnewreminder',function(){context.addReminder();});$(document).on('click','.deletereminder',function(){context.delReminder($(this));});},getReminders:function(){Ajax.call([{methodname:'theme_stardust_get_reminders',args:{},done:function(res){var response=JSON.parse(res);var data=response;templates.render(this.TEMPLATE.reminders.src,data).then(function(html){$('.popover-region-notifications .popover-region-reminder-div').append(html);}.bind(this)).fail(notification.exception);if(data.counthappend>0){setTimeout(function(){var allcount=$('.popover-region-notifications .count-container').html();if(allcount){allcount=+allcount+data.counthappend;}else{allcount=data.counthappend;}
$('.popover-region-notifications .count-container').html(allcount).removeClass('hidden');},1000);}}.bind(this),fail:notification.exception}]);},addReminder:function(){var text=$('#newremindertext').val();var date=$('#newreminderdate').val();var time=$('#newremindertime').val();if(!text.length){Str.get_string('requiredfiled','theme_stardust').done(function(s){$('#newremindertext').attr("placeholder",s);$('#newremindertext').addClass('requared');});return;}
$('#addnewreminder .fa-plus').addClass('fa-spin');Ajax.call([{methodname:'theme_stardust_add_reminder',args:{text:text,date:date,time:time},done:function(res){if(res){var response=JSON.parse(res);var data=response;templates.render(this.TEMPLATE.reminder.src,data).then(function(html){$(html).insertBefore('#opennewreminder');}.bind(this)).fail(notification.exception);}
$('#opennewreminder').click();}.bind(this),fail:notification.exception}]);},delReminder:function(target){var reminder=target.parents('.reminder');var reminderid=reminder.data('reminderid');reminder.find('.fa-close').addClass('fa-spin');Ajax.call([{methodname:'theme_stardust_del_reminder',args:{reminderid:reminderid},done:function(response){if(response==1){reminder.slideUp().remove();}}.bind(this),fail:notification.exception}]);},openReminderForm:function(){$('.addanewreminder').toggle('fast');$('#addnewreminder .fa-plus').removeClass('fa-spin');$('#newreminderdate').val('');$('#newremindertime').val('');Str.get_string('dontforget','theme_stardust').done(function(s){$('#newremindertext').val('').removeClass('requared').attr("placeholder",s);});},closeReminderForm:function(){$('.addanewreminder').toggle('fast');}};});