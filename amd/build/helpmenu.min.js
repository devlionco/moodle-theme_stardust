define(["jquery","core/ajax","core/log","core/str"],function(a,b,c,d){function e(b){27==b.keyCode&&(a("#help-menu .menu").fadeToggle("fast"),a(document).off("keyup",e))}function f(){a(h.mailBody).attr("disabled",!0),a(h.mailBody).addClass("error"),d.get_string("error_sending_message","theme_stardust").done(function(b){a(h.mailBody).val(b)})}function g(){a(h.mailBody).attr("disabled",!1),a(h.mailBody).val(""),a(h.mailBody).removeClass("error")}c.debug("Davidson Stardust AMD load src/helpmenu");var h={btnHelp:"#btn-help",btnClose:"#btn-close",btnShowTeachers:"#teacherList",mailBody:"#mailBody"};a(h.btnHelp+","+h.btnClose).on("click",function(){a("#help-menu .menu").fadeToggle("fast"),a(document).on("keyup",e)}),a(h.btnShowTeachers).on("click",function(){a(this).next().slideToggle()}),a("#sendMail").on("show.bs.modal",function(b){var c=b.relatedTarget;a(this).removeClass("showtechsupport"),"techsupport"===a(c).data("ref")&&a(this).addClass("showtechsupport"),g(),a("#teacherName").text(a(c).attr("data-name")),d.get_string("send","theme_stardust").done(function(b){a("#sendMailToTeacher").attr({"data-userid":a(c).attr("data-userid")||0,"data-courseid":a(c).attr("data-courseid")||0}).html(b).attr("disabled",!1)})}),a("#sendMailToTeacher").on("click",function(){var c=a(h.mailBody).val(),e=a("#sendMailToTeacher").attr("data-userid"),g=a("#sendMailToTeacher").attr("data-courseid");d.get_string("sending","theme_stardust").done(function(b){a("#sendMailToTeacher").html(b).attr("disabled",!0)}),b.call([{methodname:"theme_stardust_send_mail_to_teacher",args:{text:c,userid:e,courseid:g},done:function(b){"1"===b?(d.get_string("sent","theme_stardust").done(function(b){a("#sendMailToTeacher").html(b)}),setTimeout(function(){a('[data-dismiss="modal"]').trigger("click")},3e3)):f()},fail:f}])})});