
define(['jquery','core/ajax','core/log','core/str'],function($,Ajax,log,Str){log.debug('Davidson Stardust AMD load src/helpmenu');var SELECTORS={btnHelp:'#btn-help',btnClose:'#btn-close',btnShowTeachers:'#teacherList',mailBody:'#mailBody'};function handleEsc(e){if(e.keyCode==27){$('#help-menu .menu').fadeToggle('fast');$(document).off('keyup',handleEsc);}}
function handleError(){$(SELECTORS.mailBody).attr("disabled",true);$(SELECTORS.mailBody).addClass('error');Str.get_string('error_sending_message','theme_stardust').done(function(string){$(SELECTORS.mailBody).val(string);});}
function initState(){$(SELECTORS.mailBody).attr("disabled",false);$(SELECTORS.mailBody).val('');$(SELECTORS.mailBody).removeClass('error');}
$(SELECTORS.btnHelp+','+SELECTORS.btnClose).on('click',function(){$('#help-menu .menu').fadeToggle('fast');$(document).on('keyup',handleEsc);});$(SELECTORS.btnShowTeachers).on('click',function(){$(this).next().slideToggle();});$('#sendMail').on('show.bs.modal',function(e){var target=e.relatedTarget;$(this).removeClass('showtechsupport');if($(target).data('ref')==='techsupport'){$(this).addClass('showtechsupport');}
initState();$('#teacherName').text($(target).attr("data-name"));Str.get_string('send','theme_stardust').done(function(string){$('#sendMailToTeacher').attr({"data-userid":$(target).attr("data-userid")||0,"data-courseid":$(target).attr("data-courseid")||0}).html(string).attr("disabled",false);});});$('#sendMailToTeacher').on('click',function(){var text=$(SELECTORS.mailBody).val();var userid=$('#sendMailToTeacher').attr("data-userid");var courseid=$('#sendMailToTeacher').attr("data-courseid");Str.get_string('sending','theme_stardust').done(function(string){$('#sendMailToTeacher').html(string).attr("disabled",true);});Ajax.call([{methodname:'send_mail_to_teacher',args:{text:text,userid:userid,courseid:courseid},done:function(response){if(response==='1'){Str.get_string('sent','theme_stardust').done(function(string){$('#sendMailToTeacher').html(string);});setTimeout(function(){$('[data-dismiss="modal"]').trigger('click');},3000);}else{handleError();}},fail:handleError}]);});});